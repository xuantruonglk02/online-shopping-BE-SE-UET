<li class="hd-cart-icon-ctn dropdown">
  <a href="#" onclick="return false;">
    <i class="header-icon fa-solid fa-cart-shopping"></i>
    <span class="cart-number" id="cart-number"></span>
    <script>
      $(document).ready(() => {
        $.post('/cart/quantity', (data) => {
          if (data.success) {
            $('#cart-number').text(data.result.quantity);
            if (data.result.quantity == 0) {
              $('#cart-menu-products').append('<li><h3 style="color: rgb(211, 59, 51); margin-left: 10px;">Giỏ hàng của bạn đang trống</h3></li>');
              $('#cart-menu-total').text(new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' }).format(0));
            }
          }
        });
      });
    </script>
  </a>
  <ul class="dropdown-menu cart-dropdown" role="menu">
    <li>
      <div class="cart-menu-ctn">
        <div class="cart-menu">
          <div class="cart-menu-content">
            <h2>Chi tiết giỏ hàng</h2>
            <ul class="cart-menu-products" id="cart-menu-products">
            </ul>
          </div>
          <div class="cart-menu-bottom row">
            <div class="cart-menu-total row">
              <h3>Tổng cộng:</h3>
              <span id="cart-menu-total"></span>
            </div>
            <a class="view-cart-btn" href="/cart">Xem giỏ hàng</a>
          </div>
        </div>
      </div>      
    </li>
  </ul>
</li>

<script>
  $(document).ready(() => {
    $('.hd-cart-icon-ctn.dropdown').click(function () {
      if ($(this).find('.dropdown-menu').css('display') != 'none') { return; }
      $('#cart-menu-products').empty();
      $('#cart-menu-total').text('');

      $.ajax({
        type: 'POST',
        url: '/cart/menu',
        success: function (data) {
          console.log(data);
          if (!data.success) { return; }
          if (data.results.length == 0) {
            $('#cart-menu-products').append('<p>Giỏ hàng hiện trống</p>');
            $('#cart-menu-total').text(new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' }).format(0));
            return;
          }
          let total = 0;
          for (let i = 0; i < data.results.length; i++) {
            total += data.results[i].price;
            $('#cart-menu-products').append(
              '<li><div class="row"><div class="cart-menu-thumb-ctn">'
              + '<a href="/product/' + data.results[i].product_id + '">'
              + '<img src="' + data.results[i].thumbnail + '" alt=""></a></div><div class="cart-menu-name-ctn">'
              + '<a href="/product/' + data.results[i].product_id + '"><span>' + data.results[i].name + '</span></a>'
              + '</div><div class="cart-menu-price-ctn"><span>' + new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' }).format(data.results[i].price) + '</span>'
              + '</div></div></li>'
            );
          }
          $('#cart-menu-total').text(new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' }).format(total));
        },
        error: function (data) {
          if (data.status == 401) {
            window.location.href = data.responseJSON.redirect;
          }
        }
      });
    });
  });
</script>
